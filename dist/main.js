(()=>{"use strict";var e={492:function(e,t,r){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const o=s(r(691)),n=r(993);console.log("Start static http server on the 8181 port!"),n.httpServer.listen(8181),new o.default(3e3).start()},45:function(e,t,r){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const o=s(r(882)),n=s(r(17)),a=s(r(389)),i=s(r(385));t.default=class{userDB;roomsDB;transfer;constructor(e){this.userDB=new o.default,this.roomsDB=new i.default,this.transfer=e}implementMessage(e,t){const{type:r}=e;switch(console.log("implementMessage",e),r){case n.default.reg:{const r=this.userDB.addUser(e,t),s=(0,a.default)(n.default.reg,r);t.send(s);const o=this.roomsDB.getRooms(),i=(0,a.default)(n.default.update_room,o);t.send(i);const u=this.userDB.getWinners(),l=(0,a.default)(n.default.update_winners,u);this.transfer(l);break}case n.default.create_room:{const e=this.roomsDB.addRoom(t);if(e){const e=this.roomsDB.getRooms(),t=(0,a.default)(n.default.update_room,e);console.log(`Broadcasted: ${t}`),this.transfer(t)}console.log("room",e);break}default:console.log("default")}}}},385:function(e,t,r){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const o=s(r(198));t.default=class{rooms;constructor(){console.log(" New rooms DB"),this.rooms=[]}addRoom(e){if(this.getRoomByUserId(e.index))return console.log("Player can`t create more than 1 room"),null;const t=new o.default(e);return this.rooms.push(t),t}getRoomByUserId(e){return this.rooms.find((({users:t})=>t.find((t=>t.index===e))))}getRooms(){return this.rooms.filter((({users:e})=>e.length<2))}}},882:function(e,t,r){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const o=s(r(52));t.default=class{users;winners;constructor(){console.log(" New user DB"),this.users=[],this.winners=[]}addUser(e,t){const{data:{name:r,password:s}}=e,n=this.getExistUser(r);if(n)return n.password===s?(t.name=n.name,t.index=n.index,{error:!1,...n,errorText:""}):{error:!0,...n,errorText:"Password is wrong!"};const a=new o.default(r,s);return t.name=a.name,t.index=a.index,this.users.push(a),this.winners.push({name:r,wins:0}),{...a,error:!1,errorText:""}}getExistUser(e){return this.users.find((({name:t})=>e===t))}getWinners(){return this.winners}}},993:function(e,t,r){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.httpServer=void 0;const o=s(r(147)),n=r(685),a=s(r(822));t.httpServer=(0,n.createServer)(((e,t)=>{const r=a.default.resolve(a.default.dirname(""))+("/"===e.url?"/front/index.html":`/front${e.url}`);o.default.readFile(r,((e,r)=>{if(e)return t.writeHead(404),void t.end(JSON.stringify(e));t.writeHead(200),t.end(r)}))})),t.default=t.httpServer},198:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0});class r{static index=0;roomId;users;constructor(e){this.users=[];const{name:t,index:s}=e;this.roomId=r.index,this.users.push({name:t,index:s}),r.index+=1}}t.default=r},17:(e,t)=>{var r;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.reg="reg",e.create_game="create_game",e.start_game="start_game",e.turn="turn",e.attack="attack",e.finish="finish",e.update_room="update_room",e.update_winners="update_winners",e.create_room="create_room"}(r||(r={})),t.default=r},52:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0});class r{static index=0;name;password;index;constructor(e,t){this.name=e,this.password=t,this.index=r.index,r.index+=1}}t.default=r},755:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=e=>{const{data:t,...r}=JSON.parse(e.toString());return console.log("message___",JSON.parse(e.toString())),{data:""===t?t:JSON.parse(t),...r}}},389:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=(e,t)=>JSON.stringify({type:e,data:JSON.stringify(t),id:0})},691:function(e,t,r){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const o=r(352),n=s(r(755)),a=s(r(45));t.default=class{port;server;controller;constructor(e){this.port=e,this.server=new o.WebSocketServer({port:e}),this.controller=new a.default(this.transfer.bind(this))}transfer(e){this.server.clients.forEach((t=>{t.send(e)}))}start(){this.server.on("connection",(e=>{e.on("error",console.error),e.on("message",(t=>{try{const r=(0,n.default)(t);this.controller.implementMessage(r,e)}catch(e){console.log("error")}})),e.on("open",(e=>{console.log("Open",e)})),e.on("close",(e=>{console.log("Close",e)})),e.on("listening",(()=>{console.log(`WebSocker server on the ${this.port} port!`)}))}))}}},352:e=>{e.exports=require("ws")},147:e=>{e.exports=require("fs")},685:e=>{e.exports=require("http")},822:e=>{e.exports=require("path")}},t={};!function r(s){var o=t[s];if(void 0!==o)return o.exports;var n=t[s]={exports:{}};return e[s].call(n.exports,n,n.exports,r),n.exports}(492)})();